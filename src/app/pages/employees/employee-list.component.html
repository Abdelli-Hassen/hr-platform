<div class="employee-container">
  <div class="page-header">
    <div class="header-content">
      <h1>Gestion des Employés</h1>
      <p>Gérez tous les employés de votre organisation</p>
    </div>
    <button class="btn btn-primary" (click)="openForm()" *ngIf="!showForm">
      + Ajouter Employé
    </button>
  </div>

  <!-- Modal/Form -->
  <div class="modal-overlay" *ngIf="showForm" (click)="closeForm()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ editingId ? 'Modifier Employé' : 'Nouvel Employé' }}</h2>
        <button class="btn-close" (click)="closeForm()">×</button>
      </div>

      <form [formGroup]="employeeForm" class="employee-form">
        <div class="form-grid">
          <div class="form-group">
            <label>Prénom *</label>
            <input type="text" class="form-control" formControlName="firstName" />
          </div>
          <div class="form-group">
            <label>Nom *</label>
            <input type="text" class="form-control" formControlName="lastName" />
          </div>
          <div class="form-group">
            <label>Email *</label>
            <input type="email" class="form-control" formControlName="email" />
          </div>
          <div class="form-group">
            <label>Téléphone *</label>
            <input type="tel" class="form-control" formControlName="phoneNumber" />
          </div>
          <div class="form-group">
            <label>CIN *</label>
            <input type="text" class="form-control" formControlName="cin" />
          </div>
          <div class="form-group">
            <label>Date de naissance *</label>
            <input type="date" class="form-control" formControlName="birthDate" />
          </div>
          <div class="form-group col-span-2">
            <label>Adresse *</label>
            <input type="text" class="form-control" formControlName="address" />
          </div>
          <div class="form-group">
            <label>Date d'embauche *</label>
            <input type="date" class="form-control" formControlName="hireDate" />
          </div>
          <div class="form-group">
            <label>Poste *</label>
            <input type="text" class="form-control" formControlName="jobTitle" />
          </div>
          <div class="form-group">
            <label>Département *</label>
            <select class="form-control" formControlName="departmentId">
              <option value="">Sélectionner...</option>
              <option *ngFor="let dept of departments" [value]="dept">{{ dept }}</option>
            </select>
          </div>
          <div class="form-group">
            <label>Salaire (TND) *</label>
            <input type="number" class="form-control" formControlName="salary" />
          </div>
          <div class="form-group">
            <label>Type de contrat *</label>
            <select class="form-control" formControlName="contractType">
              <option *ngFor="let type of contractTypes" [value]="type">{{ type }}</option>
            </select>
          </div>
          <div class="form-group">
            <label>Statut *</label>
            <select class="form-control" formControlName="status">
              <option *ngFor="let status of statuses" [value]="status">{{ status }}</option>
            </select>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="closeForm()">Annuler</button>
          <button type="button" class="btn btn-primary" (click)="saveEmployee()" [disabled]="employeeForm.invalid || loading">
            {{ loading ? 'Enregistrement...' : 'Enregistrer' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <div class="search-box">
      <input
        type="text"
        placeholder="Rechercher par nom, email..."
        class="form-control"
        [(ngModel)]="searchText"
        (change)="onSearchChange()"
      />
    </div>
    <select class="form-control" [(ngModel)]="filterDepartment" (change)="onFilterChange()">
      <option value="">Tous les départements</option>
      <option *ngFor="let dept of departments" [value]="dept">{{ dept }}</option>
    </select>
    <select class="form-control" [(ngModel)]="filterStatus" (change)="onFilterChange()">
      <option value="">Tous les statuts</option>
      <option value="active">Actif</option>
      <option value="inactive">Inactif</option>
      <option value="on_leave">En congé</option>
    </select>
  </div>

  <!-- Employees Table -->
  <div class="table-container">
    <table class="employees-table">
      <thead>
        <tr>
          <th>Nom</th>
          <th>Email</th>
          <th>Poste</th>
          <th>Département</th>
          <th>Salaire</th>
          <th>Type Contrat</th>
          <th>Statut</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let employee of filteredEmployees" class="table-row">
          <td>
            <div class="employee-name">
              <strong>{{ employee.firstName }} {{ employee.lastName }}</strong>
            </div>
          </td>
          <td>{{ employee.email }}</td>
          <td>{{ employee.jobTitle }}</td>
          <td>{{ employee.departmentName }}</td>
          <td>{{ formatSalary(employee.salary) }}</td>
          <td>{{ employee.contractType }}</td>
          <td>
            <span [ngClass]="getStatusBadgeClass(employee.status || 'active')">
              {{ employee.status || 'active' }}
            </span>
          </td>
          <td>
            <div class="action-buttons">
              <button class="btn btn-sm btn-info" (click)="openForm(employee)">Modifier</button>
              <button class="btn btn-sm btn-danger" (click)="deleteEmployee(employee.id)">Supprimer</button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
    <div *ngIf="filteredEmployees.length === 0" class="empty-state">
      <p>Aucun employé trouvé</p>
    </div>
  </div>
</div>
